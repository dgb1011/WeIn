(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[131],{6595:(e,a,t)=>{Promise.resolve().then(t.bind(t,2868))},7515:(e,a,t)=>{"use strict";t.d(a,{Z:()=>s});let s=(0,t(1066).Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},8165:(e,a,t)=>{"use strict";t.d(a,{Z:()=>s});let s=(0,t(1066).Z)("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]])},4109:(e,a,t)=>{"use strict";t.d(a,{Z:()=>s});let s=(0,t(1066).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},7390:(e,a,t)=>{"use strict";t.d(a,{Z:()=>s});let s=(0,t(1066).Z)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]])},4258:(e,a,t)=>{"use strict";t.d(a,{Z:()=>s});let s=(0,t(1066).Z)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},1240:(e,a,t)=>{"use strict";t.d(a,{Z:()=>s});let s=(0,t(1066).Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])},6463:(e,a,t)=>{"use strict";var s=t(1169);t.o(s,"useParams")&&t.d(a,{useParams:function(){return s.useParams}}),t.o(s,"useRouter")&&t.d(a,{useRouter:function(){return s.useRouter}})},2868:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>z});var s=t(7437),r=t(2265),i=t(6463),l=t(9733),n=t(1066);let c=(0,n.Z)("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),o=(0,n.Z)("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),d=(0,n.Z)("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]),u=(0,n.Z)("VideoOff",[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.34l1 1L22 8v8",key:"ubwiq0"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2l10 10Z",key:"1l10zd"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),h=(0,n.Z)("MonitorOff",[["path",{d:"M17 17H4a2 2 0 0 1-2-2V5c0-1.5 1-2 1-2",key:"k0q8oc"}],["path",{d:"M22 15V5a2 2 0 0 0-2-2H9",key:"cp1ac0"}],["path",{d:"M8 21h8",key:"1ev6f3"}],["path",{d:"M12 17v4",key:"1riwvh"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),x=(0,n.Z)("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]),m=(0,n.Z)("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);var g=t(8165),f=t(7390),y=t(1240),p=t(4258);let v=(0,n.Z)("PhoneOff",[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]]);function j(e){let{isAudioEnabled:a,isVideoEnabled:t,isScreenSharing:r,isRecording:i,onToggleAudio:n,onToggleVideo:j,onToggleScreenShare:b,onToggleRecording:N,onLeave:w,onToggleChat:k,onToggleParticipants:S,onSettings:z,showChat:Z=!1,showParticipants:T=!1}=e;return(0,s.jsxs)("div",{className:"flex items-center justify-center space-x-4 p-4 bg-gray-800 border-t border-gray-700",children:[(0,s.jsx)(l.z,{variant:a?"default":"destructive",size:"lg",onClick:n,className:"rounded-full w-12 h-12",title:a?"Mute microphone":"Unmute microphone",children:a?(0,s.jsx)(c,{className:"h-5 w-5"}):(0,s.jsx)(o,{className:"h-5 w-5"})}),(0,s.jsx)(l.z,{variant:t?"default":"destructive",size:"lg",onClick:j,className:"rounded-full w-12 h-12",title:t?"Turn off camera":"Turn on camera",children:t?(0,s.jsx)(d,{className:"h-5 w-5"}):(0,s.jsx)(u,{className:"h-5 w-5"})}),(0,s.jsx)(l.z,{variant:r?"destructive":"secondary",size:"lg",onClick:b,className:"rounded-full w-12 h-12",title:r?"Stop screen sharing":"Share screen",children:r?(0,s.jsx)(h,{className:"h-5 w-5"}):(0,s.jsx)(x,{className:"h-5 w-5"})}),(0,s.jsx)(l.z,{variant:i?"destructive":"secondary",size:"lg",onClick:N,className:"rounded-full w-12 h-12",title:i?"Stop recording":"Start recording",children:i?(0,s.jsx)(m,{className:"h-5 w-5"}):(0,s.jsx)(g.Z,{className:"h-5 w-5"})}),k&&(0,s.jsx)(l.z,{variant:Z?"default":"secondary",size:"lg",onClick:k,className:"rounded-full w-12 h-12",title:"Toggle chat",children:(0,s.jsx)(f.Z,{className:"h-5 w-5"})}),S&&(0,s.jsx)(l.z,{variant:T?"default":"secondary",size:"lg",onClick:S,className:"rounded-full w-12 h-12",title:"Toggle participants list",children:(0,s.jsx)(y.Z,{className:"h-5 w-5"})}),z&&(0,s.jsx)(l.z,{variant:"ghost",size:"lg",onClick:z,className:"rounded-full w-12 h-12 text-white hover:bg-gray-700",title:"Settings",children:(0,s.jsx)(p.Z,{className:"h-5 w-5"})}),(0,s.jsx)(l.z,{variant:"destructive",size:"lg",onClick:w,className:"rounded-full w-12 h-12",title:"Leave call",children:(0,s.jsx)(v,{className:"h-5 w-5"})})]})}function b(e){let{participant:a,isMainView:t=!1,className:i=""}=e,l=(0,r.useRef)(null);return(0,r.useEffect)(()=>{l.current&&a.stream&&(l.current.srcObject=a.stream)},[a.stream]),(0,s.jsxs)("div",{className:"relative ".concat(i),children:[(0,s.jsx)("video",{ref:l,autoPlay:!0,playsInline:!0,muted:a.isLocal,className:"w-full h-full object-cover rounded-lg ".concat(t?"bg-gray-800":"bg-gray-700")}),!a.videoEnabled&&(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-900 rounded-lg",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(u,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),(0,s.jsx)("p",{className:"text-gray-400 text-sm",children:a.isLocal?"Your camera is off":"Camera is off"})]})}),(0,s.jsxs)("div",{className:"absolute bottom-4 left-4 flex items-center space-x-2",children:[(0,s.jsx)("div",{className:"w-8 h-8 ".concat((()=>{switch(a.userType){case"student":return"bg-blue-600";case"consultant":return"bg-green-600";case"admin":return"bg-purple-600";default:return"bg-gray-600"}})()," rounded-full flex items-center justify-center"),children:(0,s.jsx)("span",{className:"text-white text-sm font-medium",children:a.userType.charAt(0).toUpperCase()})}),(0,s.jsx)("div",{className:"bg-black bg-opacity-50 text-white px-2 py-1 rounded text-sm",children:a.isLocal?"You":a.userType.charAt(0).toUpperCase()+a.userType.slice(1)})]}),(0,s.jsxs)("div",{className:"absolute top-4 right-4 flex items-center space-x-2",children:[(0,s.jsx)("div",{className:"p-1 rounded-full ".concat(a.audioEnabled?"bg-green-500":"bg-red-500"),children:a.audioEnabled?(0,s.jsx)(c,{className:"h-3 w-3 text-white"}):(0,s.jsx)(o,{className:"h-3 w-3 text-white"})}),a.screenSharing&&(0,s.jsx)("div",{className:"bg-blue-500 p-1 rounded-full",children:(0,s.jsx)(x,{className:"h-3 w-3 text-white"})})]}),a.isLocal&&(0,s.jsx)("div",{className:"absolute top-4 left-4 bg-blue-600 text-white px-2 py-1 rounded text-xs font-medium",children:"You"}),!a.isLocal&&(0,s.jsxs)("div",{className:"absolute bottom-4 right-4 flex space-x-1",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,s.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,s.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"})]})]})}function N(e){let{roomId:a,sessionId:t,onLeave:i,isHost:l=!1}=e,[n,c]=(0,r.useState)([]),[o,d]=(0,r.useState)(!0),[u,h]=(0,r.useState)(!0),[x,m]=(0,r.useState)(!1),[g,f]=(0,r.useState)(!1),[y,p]=(0,r.useState)(!1),[v,N]=(0,r.useState)(!1),[w,k]=(0,r.useState)(null),[S,z]=(0,r.useState)(!0);(0,r.useEffect)(()=>(Z(),()=>{C()}),[]);let Z=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({video:{width:1280,height:720},audio:{echoCancellation:!0,noiseSuppression:!0}});k(e),c([{id:"local",userId:"local",userType:"student",isLocal:!0,stream:e,audioEnabled:o,videoEnabled:u,screenSharing:!1}]),z(!1),await T()}catch(e){console.error("Error initializing video:",e),z(!1)}},T=async()=>{try{let e=await fetch("/api/video",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify({action:"joinRoom",roomId:a})});if(e.ok){let a=await e.json();console.log("Joined video room:",a)}}catch(e){console.error("Error joining video room:",e)}},C=()=>{w&&w.getTracks().forEach(e=>e.stop())},M=async()=>{try{if(x){if(w){let e=w.getVideoTracks()[0];w.removeTrack(e);let a=(await navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0];w.addTrack(a)}m(!1)}else{let e=await navigator.mediaDevices.getDisplayMedia({video:!0});if(m(!0),w){let a=w.getVideoTracks()[0],t=e.getVideoTracks()[0];w.removeTrack(a),w.addTrack(t)}}}catch(e){console.error("Error toggling screen share:",e)}},E=async()=>{try{await fetch("/api/video",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify({action:"leaveRoom",roomId:a})})}catch(e){console.error("Error leaving video room:",e)}finally{C(),i()}};return S?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-900",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-white",children:"Connecting to video session..."})]})}):(0,s.jsxs)("div",{className:"flex flex-col h-screen bg-gray-900",children:[(0,s.jsx)("div",{className:"flex-1 relative",children:0===n.length?(0,s.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,s.jsx)("p",{className:"text-white",children:"No participants in the room"})}):1===n.length?(0,s.jsx)("div",{className:"h-full",children:(0,s.jsx)(b,{participant:n[0],isMainView:!0,className:"h-full"})}):(0,s.jsx)("div",{className:"grid grid-cols-2 gap-4 h-full p-4",children:n.map((e,a)=>(0,s.jsx)(b,{participant:e,isMainView:0===a,className:0===a?"col-span-2":""},e.id))})}),(0,s.jsx)(j,{isAudioEnabled:o,isVideoEnabled:u,isScreenSharing:x,isRecording:g,onToggleAudio:()=>{if(w){let e=w.getAudioTracks()[0];e&&(e.enabled=!e.enabled,d(e.enabled))}},onToggleVideo:()=>{if(w){let e=w.getVideoTracks()[0];e&&(e.enabled=!e.enabled,h(e.enabled))}},onToggleScreenShare:M,onToggleRecording:()=>{f(!g)},onLeave:E,onToggleChat:()=>p(!y),onToggleParticipants:()=>N(!v),showChat:y,showParticipants:v})]})}var w=t(8185),k=t(4109),S=t(7515);function z(){let e=(0,i.useParams)(),a=(0,i.useRouter)(),t=e.sessionId,[n,c]=(0,r.useState)(!0),[o,d]=(0,r.useState)(null),[u,h]=(0,r.useState)(null),[x,m]=(0,r.useState)(null);(0,r.useEffect)(()=>{g()},[t]);let g=async()=>{try{c(!0),d(null);let e=localStorage.getItem("token");if(!e){a.push("/auth/login");return}let s=await fetch("/api/consultants?action=sessionHistory&sessionId=".concat(t),{headers:{Authorization:"Bearer ".concat(e)}});if(!s.ok)throw Error("Failed to load session data");let r=await s.json();h(r.sessions[0]);let i=await fetch("/api/video",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({action:"createRoom",sessionId:t,recordingEnabled:!0,maxParticipants:2,quality:"720p"})});if(!i.ok)throw Error("Failed to create video room");let l=await i.json();m(l.room.roomId),c(!1)}catch(e){console.error("Error initializing session:",e),d(e instanceof Error?e.message:"Failed to initialize session"),c(!1)}},f=()=>{a.push("/dashboard")};return n?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-900",children:(0,s.jsx)(w.Zb,{className:"w-96",children:(0,s.jsxs)(w.aY,{className:"flex flex-col items-center space-y-4 p-6",children:[(0,s.jsx)(k.Z,{className:"h-12 w-12 animate-spin text-blue-600"}),(0,s.jsx)(w.ll,{children:"Initializing Video Session"}),(0,s.jsx)("p",{className:"text-gray-600 text-center",children:"Setting up your EMDR consultation session..."})]})})}):o?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-900",children:(0,s.jsx)(w.Zb,{className:"w-96",children:(0,s.jsxs)(w.aY,{className:"flex flex-col items-center space-y-4 p-6",children:[(0,s.jsx)(S.Z,{className:"h-12 w-12 text-red-600"}),(0,s.jsx)(w.ll,{children:"Session Error"}),(0,s.jsx)("p",{className:"text-red-600 text-center",children:o}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)(l.z,{onClick:g,variant:"outline",children:"Retry"}),(0,s.jsx)(l.z,{onClick:f,children:"Return to Dashboard"})]})]})})}):x?(0,s.jsx)(N,{roomId:x,sessionId:t,onLeave:f,isHost:!0}):(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-900",children:(0,s.jsx)(w.Zb,{className:"w-96",children:(0,s.jsxs)(w.aY,{className:"flex flex-col items-center space-y-4 p-6",children:[(0,s.jsx)(S.Z,{className:"h-12 w-12 text-yellow-600"}),(0,s.jsx)(w.ll,{children:"Room Not Ready"}),(0,s.jsx)("p",{className:"text-gray-600 text-center",children:"Video room is not available. Please try again."}),(0,s.jsx)(l.z,{onClick:g,variant:"outline",children:"Retry"})]})})})}},9733:(e,a,t)=>{"use strict";t.d(a,{z:()=>o});var s=t(7437),r=t(2265),i=t(1538),l=t(3027),n=t(9354);let c=(0,l.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),o=r.forwardRef((e,a)=>{let{className:t,variant:r,size:l,asChild:o=!1,...d}=e,u=o?i.g7:"button";return(0,s.jsx)(u,{className:(0,n.cn)(c({variant:r,size:l,className:t})),ref:a,...d})});o.displayName="Button"},8185:(e,a,t)=>{"use strict";t.d(a,{Ol:()=>n,SZ:()=>o,Zb:()=>l,aY:()=>d,ll:()=>c});var s=t(7437),r=t(2265),i=t(9354);let l=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...r})});l.displayName="Card";let n=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",t),...r})});n.displayName="CardHeader";let c=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("h3",{ref:a,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",t),...r})});c.displayName="CardTitle";let o=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("p",{ref:a,className:(0,i.cn)("text-sm text-muted-foreground",t),...r})});o.displayName="CardDescription";let d=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,className:(0,i.cn)("p-6 pt-0",t),...r})});d.displayName="CardContent",r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,className:(0,i.cn)("flex items-center p-6 pt-0",t),...r})}).displayName="CardFooter"},9354:(e,a,t)=>{"use strict";t.d(a,{cn:()=>i});var s=t(4839),r=t(6164);function i(){for(var e=arguments.length,a=Array(e),t=0;t<e;t++)a[t]=arguments[t];return(0,r.m6)((0,s.W)(a))}}},e=>{var a=a=>e(e.s=a);e.O(0,[748,130,215,744],()=>a(6595)),_N_E=e.O()}]);