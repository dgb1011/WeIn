exports.id=991,exports.ids=[991],exports.modules={5303:()=>{},4871:(e,t,s)=>{"use strict";s.d(t,{db:()=>o});var i=s(3524);let o=globalThis.prisma??new i.PrismaClient},2391:(e,t,s)=>{"use strict";s.d(t,{BF:()=>u,RX:()=>o,k$:()=>i});var i,o,n,a=s(4871);(function(e){e.SESSION_SCHEDULED="SESSION_SCHEDULED",e.SESSION_REMINDER_24H="SESSION_REMINDER_24H",e.SESSION_REMINDER_2H="SESSION_REMINDER_2H",e.SESSION_REMINDER_15M="SESSION_REMINDER_15M",e.SESSION_CANCELLED="SESSION_CANCELLED",e.SESSION_RESCHEDULED="SESSION_RESCHEDULED",e.SESSION_COMPLETED="SESSION_COMPLETED",e.MILESTONE_REACHED="MILESTONE_REACHED",e.PROGRESS_UPDATE="PROGRESS_UPDATE",e.CERTIFICATION_ELIGIBLE="CERTIFICATION_ELIGIBLE",e.CERTIFICATION_COMPLETED="CERTIFICATION_COMPLETED",e.DOCUMENT_UPLOADED="DOCUMENT_UPLOADED",e.DOCUMENT_APPROVED="DOCUMENT_APPROVED",e.DOCUMENT_REJECTED="DOCUMENT_REJECTED",e.DOCUMENT_REVIEW_REQUIRED="DOCUMENT_REVIEW_REQUIRED",e.SYSTEM_MAINTENANCE="SYSTEM_MAINTENANCE",e.SYSTEM_UPDATE="SYSTEM_UPDATE",e.SECURITY_ALERT="SECURITY_ALERT",e.NEW_BOOKING="NEW_BOOKING",e.SESSION_VERIFICATION_REQUIRED="SESSION_VERIFICATION_REQUIRED",e.PAYMENT_PROCESSED="PAYMENT_PROCESSED",e.USER_REGISTRATION="USER_REGISTRATION",e.SYSTEM_ALERT="SYSTEM_ALERT",e.PERFORMANCE_METRIC="PERFORMANCE_METRIC"})(i||(i={})),function(e){e.LOW="LOW",e.NORMAL="NORMAL",e.HIGH="HIGH",e.URGENT="URGENT"}(o||(o={})),function(e){e.EMAIL="EMAIL",e.SMS="SMS",e.IN_APP="IN_APP",e.PUSH="PUSH"}(n||(n={}));class r{constructor(){this.templates=new Map,this.initializeTemplates()}initializeTemplates(){this.templates.set("SESSION_SCHEDULED",{id:"session_scheduled",type:"SESSION_SCHEDULED",subject:"Consultation Session Scheduled",body:`
        <h2>Your consultation session has been scheduled!</h2>
        <p>Hello {{firstName}},</p>
        <p>Your consultation session with {{consultantName}} has been scheduled for:</p>
        <ul>
          <li><strong>Date:</strong> {{sessionDate}}</li>
          <li><strong>Time:</strong> {{sessionTime}}</li>
          <li><strong>Duration:</strong> {{duration}} minutes</li>
        </ul>
        <p>You can join the session 5 minutes before the scheduled time.</p>
        <p>If you need to reschedule, please contact us at least 24 hours in advance.</p>
      `,smsBody:"Your consultation session with {{consultantName}} is scheduled for {{sessionDate}} at {{sessionTime}}. Join 5 min early.",variables:["firstName","consultantName","sessionDate","sessionTime","duration"]}),this.templates.set("SESSION_REMINDER_24H",{id:"session_reminder_24h",type:"SESSION_REMINDER_24H",subject:"Reminder: Consultation Session Tomorrow",body:`
        <h2>Reminder: Your consultation session is tomorrow</h2>
        <p>Hello {{firstName}},</p>
        <p>This is a friendly reminder that your consultation session is scheduled for tomorrow:</p>
        <ul>
          <li><strong>Date:</strong> {{sessionDate}}</li>
          <li><strong>Time:</strong> {{sessionTime}}</li>
          <li><strong>Consultant:</strong> {{consultantName}}</li>
        </ul>
        <p>Please ensure you have a stable internet connection and are in a quiet environment.</p>
      `,smsBody:"Reminder: Your consultation session with {{consultantName}} is tomorrow at {{sessionTime}}.",variables:["firstName","consultantName","sessionDate","sessionTime"]}),this.templates.set("SESSION_REMINDER_2H",{id:"session_reminder_2h",type:"SESSION_REMINDER_2H",subject:"Reminder: Consultation Session in 2 Hours",body:`
        <h2>Your consultation session starts in 2 hours</h2>
        <p>Hello {{firstName}},</p>
        <p>Your consultation session with {{consultantName}} starts in 2 hours at {{sessionTime}}.</p>
        <p>Please prepare your environment and ensure you're ready for the session.</p>
      `,smsBody:"Your consultation session with {{consultantName}} starts in 2 hours at {{sessionTime}}.",variables:["firstName","consultantName","sessionTime"]}),this.templates.set("SESSION_REMINDER_15M",{id:"session_reminder_15m",type:"SESSION_REMINDER_15M",subject:"Your consultation session starts in 15 minutes",body:`
        <h2>Session starting soon!</h2>
        <p>Hello {{firstName}},</p>
        <p>Your consultation session with {{consultantName}} starts in 15 minutes.</p>
        <p>You can now join the session room.</p>
      `,smsBody:"Your consultation session with {{consultantName}} starts in 15 minutes. Join now.",variables:["firstName","consultantName"]}),this.templates.set("MILESTONE_REACHED",{id:"milestone_reached",type:"MILESTONE_REACHED",subject:"Congratulations! You've reached a milestone",body:`
        <h2>ðŸŽ‰ Milestone Achieved!</h2>
        <p>Hello {{firstName}},</p>
        <p>Congratulations! You've reached {{milestoneName}} with {{hoursCompleted}} hours completed.</p>
        <p>You're making excellent progress toward your certification!</p>
      `,smsBody:"\uD83C\uDF89 Congratulations! You've reached {{milestoneName}} with {{hoursCompleted}} hours completed.",variables:["firstName","milestoneName","hoursCompleted"]}),this.templates.set("CERTIFICATION_ELIGIBLE",{id:"certification_eligible",type:"CERTIFICATION_ELIGIBLE",subject:"You're eligible for certification!",body:`
        <h2>ðŸŽ“ Certification Eligibility</h2>
        <p>Hello {{firstName}},</p>
        <p>Great news! You've completed all requirements and are now eligible for certification.</p>
        <p>Your certificate will be generated and sent to you within 24 hours.</p>
      `,smsBody:"\uD83C\uDF93 Great news! You're eligible for certification. Your certificate will be sent within 24 hours.",variables:["firstName"]}),this.templates.set("DOCUMENT_APPROVED",{id:"document_approved",type:"DOCUMENT_APPROVED",subject:"Document Approved",body:`
        <h2>Document Approved</h2>
        <p>Hello {{firstName}},</p>
        <p>Your document "{{documentName}}" has been approved.</p>
        <p>This brings you one step closer to certification!</p>
      `,smsBody:'Your document "{{documentName}}" has been approved.',variables:["firstName","documentName"]}),this.templates.set("DOCUMENT_REJECTED",{id:"document_rejected",type:"DOCUMENT_REJECTED",subject:"Document Review Required",body:`
        <h2>Document Review Required</h2>
        <p>Hello {{firstName}},</p>
        <p>Your document "{{documentName}}" requires revisions.</p>
        <p><strong>Feedback:</strong> {{feedback}}</p>
        <p>Please review and resubmit the document.</p>
      `,smsBody:'Your document "{{documentName}}" requires revisions. Check your email for details.',variables:["firstName","documentName","feedback"]}),this.templates.set("NEW_BOOKING",{id:"new_booking",type:"NEW_BOOKING",subject:"New Session Booking",body:`
        <h2>New Session Booking</h2>
        <p>Hello {{consultantName}},</p>
        <p>You have a new consultation session booked:</p>
        <ul>
          <li><strong>Student:</strong> {{studentName}}</li>
          <li><strong>Date:</strong> {{sessionDate}}</li>
          <li><strong>Time:</strong> {{sessionTime}}</li>
          <li><strong>Duration:</strong> {{duration}} minutes</li>
        </ul>
      `,smsBody:"New booking: {{studentName}} on {{sessionDate}} at {{sessionTime}}.",variables:["consultantName","studentName","sessionDate","sessionTime","duration"]}),this.templates.set("SESSION_VERIFICATION_REQUIRED",{id:"session_verification_required",type:"SESSION_VERIFICATION_REQUIRED",subject:"Session Verification Required",body:`
        <h2>Session Verification Required</h2>
        <p>Hello {{consultantName}},</p>
        <p>Please verify your recent session with {{studentName}} on {{sessionDate}}.</p>
        <p>This helps ensure accurate progress tracking and payment processing.</p>
      `,smsBody:"Please verify your session with {{studentName}} on {{sessionDate}}.",variables:["consultantName","studentName","sessionDate"]})}async sendNotification(e){try{let t=await a.db.user.findUnique({where:{id:e.userId},include:{student:!0,consultant:!0,admin:!0}});if(!t)throw Error(`User not found: ${e.userId}`);let s=await this.getUserNotificationPreferences(e.userId);if(this.isInQuietHours(s)){console.log(`Skipping notification during quiet hours for user ${e.userId}`);return}let i=[];s.emailEnabled&&this.shouldSendEmail(e.type,s)&&i.push(this.sendEmailNotification(t,e)),s.smsEnabled&&this.shouldSendSMS(e.type,s)&&i.push(this.sendSMSNotification(t,e)),s.inAppEnabled&&this.shouldSendInApp(e.type,s)&&i.push(this.createInAppNotification(e)),await Promise.all(i),await this.logNotification(e)}catch(e){throw console.error("Error sending notification:",e),e}}async sendBulkNotifications(e){let t=e.map(e=>this.sendNotification(e));await Promise.all(t)}async scheduleNotification(e,t){await a.db.scheduledNotification.create({data:{userId:e.userId,type:e.type,title:e.title,message:e.message,data:e.data,priority:e.priority,scheduledFor:t,status:"PENDING"}})}async sendSessionNotifications(e){let t=await a.db.consultationSession.findUnique({where:{id:e},include:{student:{include:{user:!0}},consultant:{include:{user:!0}}}});if(!t)throw Error(`Session not found: ${e}`);let s=new Date(t.scheduledStart),i=s.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",timeZone:"UTC"});for(let e of(await this.sendNotification({userId:t.student.user.id,type:"SESSION_SCHEDULED",title:"Session Scheduled",message:`Your consultation session with ${t.consultant.user.firstName} ${t.consultant.user.lastName} has been scheduled for ${s.toLocaleDateString()} at ${i}.`,data:{sessionId:t.id,consultantName:`${t.consultant.user.firstName} ${t.consultant.user.lastName}`,sessionDate:s.toLocaleDateString(),sessionTime:i,duration:Math.round((t.scheduledEnd.getTime()-t.scheduledStart.getTime())/6e4)},priority:"NORMAL"}),await this.sendNotification({userId:t.consultant.user.id,type:"NEW_BOOKING",title:"New Session Booking",message:`New consultation session booked with ${t.student.user.firstName} ${t.student.user.lastName} on ${s.toLocaleDateString()} at ${i}.`,data:{sessionId:t.id,studentName:`${t.student.user.firstName} ${t.student.user.lastName}`,sessionDate:s.toLocaleDateString(),sessionTime:i,duration:Math.round((t.scheduledEnd.getTime()-t.scheduledStart.getTime())/6e4)},priority:"NORMAL"}),[{hours:24,type:"SESSION_REMINDER_24H"},{hours:2,type:"SESSION_REMINDER_2H"},{minutes:15,type:"SESSION_REMINDER_15M"}])){let s=new Date(t.scheduledStart);e.hours?s.setHours(s.getHours()-e.hours):e.minutes&&s.setMinutes(s.getMinutes()-e.minutes),s>new Date&&await this.scheduleNotification({userId:t.student.user.id,type:e.type,title:"Session Reminder",message:`Your consultation session starts ${e.hours?`in ${e.hours} hours`:"in 15 minutes"}.`,data:{sessionId:t.id},priority:"HIGH"},s)}}async sendMilestoneNotification(e,t,s){await this.sendNotification({userId:e,type:"MILESTONE_REACHED",title:"Milestone Achieved!",message:`Congratulations! You've reached ${t} with ${s} hours completed.`,data:{milestoneName:t,hoursCompleted:s},priority:"NORMAL"})}async sendCertificationEligibleNotification(e){await this.sendNotification({userId:e,type:"CERTIFICATION_ELIGIBLE",title:"Certification Eligible!",message:"Great news! You've completed all requirements and are now eligible for certification.",data:{},priority:"HIGH"})}async sendDocumentNotification(e,t,s,i){await this.sendNotification({userId:e,type:"approved"===s?"DOCUMENT_APPROVED":"DOCUMENT_REJECTED",title:`Document ${"approved"===s?"Approved":"Review Required"}`,message:"approved"===s?`Your document "${t}" has been approved.`:`Your document "${t}" requires revisions.`,data:{documentName:t,feedback:i},priority:"NORMAL"})}async sendEmailNotification(e,t){let s=this.templates.get(t.type);if(!s){console.warn(`No email template found for notification type: ${t.type}`);return}let i=this.processTemplate(s,t.data||{}),o=s.subject;console.log("Sending email notification:",{to:e.email,subject:o,body:i})}async sendSMSNotification(e,t){let s=this.templates.get(t.type);if(!s?.smsBody){console.warn(`No SMS template found for notification type: ${t.type}`);return}let i=this.processTemplate(s,t.data||{},"smsBody");console.log("Sending SMS notification:",{to:e.phone,message:i})}async createInAppNotification(e){await a.db.inAppNotification.create({data:{userId:e.userId,title:e.title,message:e.message,type:e.type,data:e.data,read:!1}})}async getUserNotificationPreferences(e){return await a.db.userNotificationPreferences.findUnique({where:{userId:e}})||{userId:e,emailEnabled:!0,smsEnabled:!1,inAppEnabled:!0,pushEnabled:!1,quietHours:{enabled:!1,startTime:"22:00",endTime:"08:00",timezone:"UTC"},notificationTypes:this.getDefaultNotificationTypes()}}getDefaultNotificationTypes(){let e={};return Object.values(i).forEach(t=>{e[t]={email:!0,sms:!1,inApp:!0,push:!1}}),e}isInQuietHours(e){if(!e.quietHours.enabled)return!1;let t=new Date,s=e.quietHours.timezone||"UTC",i=new Date(t.toLocaleString("en-US",{timeZone:s})),o=60*i.getHours()+i.getMinutes(),n=this.parseTimeString(e.quietHours.startTime),a=this.parseTimeString(e.quietHours.endTime);return n<=a?o>=n&&o<=a:o>=n||o<=a}parseTimeString(e){let[t,s]=e.split(":").map(Number);return 60*t+s}shouldSendEmail(e,t){return t.notificationTypes[e]?.email??!0}shouldSendSMS(e,t){return t.notificationTypes[e]?.sms??!1}shouldSendInApp(e,t){return t.notificationTypes[e]?.inApp??!0}processTemplate(e,t,s="body"){let i=e[s]||e.body;return e.variables.forEach(e=>{let s=t[e]||`{{${e}}}`,o=RegExp(`{{${e}}}`,"g");i=i.replace(o,s)}),i}async logNotification(e){await a.db.notificationLog.create({data:{userId:e.userId,type:e.type,title:e.title,message:e.message,data:e.data,priority:e.priority,sentAt:new Date}})}async getUserNotifications(e,t=50,s=0){return(await a.db.inAppNotification.findMany({where:{userId:e},orderBy:{createdAt:"desc"},take:t,skip:s})).map(e=>({userId:e.userId,title:e.title,message:e.message,type:e.type,data:e.data,read:e.read,createdAt:e.createdAt}))}async markNotificationAsRead(e){await a.db.inAppNotification.update({where:{id:e},data:{read:!0}})}async markAllNotificationsAsRead(e){await a.db.inAppNotification.updateMany({where:{userId:e,read:!1},data:{read:!0}})}async getUnreadNotificationCount(e){return await a.db.inAppNotification.count({where:{userId:e,read:!1}})}async updateUserPreferences(e,t){await a.db.userNotificationPreferences.upsert({where:{userId:e},update:t,create:{userId:e,...t}})}}let u=new r}};