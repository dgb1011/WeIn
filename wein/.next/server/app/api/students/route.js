(()=>{var e={};e.id=6393,e.ids=[6393],e.modules={3524:e=>{"use strict";e.exports=require("@prisma/client")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9348:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},412:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},8893:e=>{"use strict";e.exports=require("buffer")},4770:e=>{"use strict";e.exports=require("crypto")},6162:e=>{"use strict";e.exports=require("stream")},1764:e=>{"use strict";e.exports=require("util")},5956:(e,t,s)=>{"use strict";s.r(t),s.d(t,{patchFetch:()=>g,routeModule:()=>p,serverHooks:()=>f,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>m});var r={};s.r(r),s.d(r,{GET:()=>c,PUT:()=>d});var a=s(2412),n=s(4293),u=s(4147),i=s(7856),o=s(5169),l=s(8772);async function c(e){try{let t=await (0,l.ts)(e);if(!t||"STUDENT"!==t.userType)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:s}=new URL(e.url),r=s.get("action");if("progress"===r){let e=await o.V.getStudentProgress(t.id);return i.NextResponse.json({progress:e})}if("sessions"===r){let e=s.get("status")?.split(","),r=parseInt(s.get("limit")||"20"),a=parseInt(s.get("offset")||"0"),n=await o.V.getStudentSessions(t.id,{status:e,limit:r,offset:a});return i.NextResponse.json(n)}return i.NextResponse.json({error:"Invalid action"},{status:400})}catch(e){return console.error("Student API Error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function d(e){try{let t=await (0,l.ts)(e);if(!t||"STUDENT"!==t.userType)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{action:s,status:r}=await e.json();if("updateStatus"===s&&r)return await o.V.updateStudentStatus(t.id,r),i.NextResponse.json({message:"Status updated successfully"});return i.NextResponse.json({error:"Invalid action"},{status:400})}catch(e){return console.error("Student API Error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}let p=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/students/route",pathname:"/api/students",filename:"route",bundlePath:"app/api/students/route"},resolvedPagePath:"/Users/dgb_1011/Desktop/WeIn/WeIn/wein/src/app/api/students/route.ts",nextConfigOutput:"",userland:r}),{workAsyncStorage:h,workUnitAsyncStorage:m,serverHooks:f}=p;function g(){return(0,u.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:m})}},5303:()=>{},8772:(e,t,s)=>{"use strict";s.d(t,{ts:()=>i});var r=s(3449),a=s.n(r),n=s(4871);let u=process.env.JWT_SECRET||"your-secret-key";async function i(e){try{let t=e.headers.get("authorization")?.replace("Bearer ","");if(!t)return null;let s=function(e){try{return a().verify(e,u)}catch(e){return null}}(t);if(!s)return null;return await n.db.user.findUnique({where:{id:s.userId},select:{id:!0,email:!0,firstName:!0,lastName:!0,userType:!0,status:!0}})}catch(e){return console.error("Auth middleware error:",e),null}}},4871:(e,t,s)=>{"use strict";s.d(t,{db:()=>a});var r=s(3524);let a=globalThis.prisma??new r.PrismaClient({log:["error"],datasources:{db:{url:process.env.DATABASE_URL}}});process.on("beforeExit",async()=>{await a.$disconnect()})},5169:(e,t,s)=>{"use strict";s.d(t,{V:()=>a});var r=s(4871);class a{static async getStudentProgress(e){let t=await r.db.consultationSession.findMany({where:{studentId:e},include:{consultant:{include:{user:!0}}}}),s=t.filter(e=>"COMPLETED"===e.status&&e.consultantVerifiedAt),a=t.filter(e=>"COMPLETED"===e.status&&!e.consultantVerifiedAt),n=t.filter(e=>"SCHEDULED"===e.status||"CONFIRMED"===e.status),u=s.reduce((e,t)=>e+this.calculateSessionDuration(t),0),i=a.reduce((e,t)=>e+this.calculateSessionDuration(t),0),o=n.reduce((e,t)=>e+this.calculateSessionDuration(t),0),l=Math.min(u/40*100,100),c=Math.max(40-u,0),d=this.estimateCompletionDate(u,o,t),p=this.calculateWeeklyProgress(t),h=this.getMilestoneStatus(u);return{verifiedHours:u,pendingHours:i,projectedHours:o,completionPercentage:l,remainingHours:c,estimatedCompletionDate:d,weeklyProgress:p,milestoneStatus:h,consultantDistribution:this.analyzeConsultantDistribution(t)}}static async updateStudentStatus(e,t){await r.db.student.update({where:{id:e},data:{certificationStatus:t}})}static async getStudentSessions(e,t={}){let{status:s,limit:a=20,offset:n=0}=t,u={studentId:e};s&&s.length>0&&(u.status={in:s});let i=await r.db.consultationSession.findMany({where:u,include:{consultant:{include:{user:!0}},videoSession:!0},orderBy:{scheduledStart:"desc"},take:a,skip:n}),o=await r.db.consultationSession.count({where:u});return{sessions:i,total:o,hasMore:n+a<o}}static calculateSessionDuration(e){return e.actualStart&&e.actualEnd?(new Date(e.actualEnd).getTime()-new Date(e.actualStart).getTime())/36e5:(new Date(e.scheduledEnd).getTime()-new Date(e.scheduledStart).getTime())/36e5}static estimateCompletionDate(e,t,s){if(e>=40)return null;let r=s.filter(e=>"COMPLETED"===e.status&&e.consultantVerifiedAt);if(0===r.length)return null;let a=new Date(Math.min(...r.map(e=>new Date(e.scheduledStart).getTime()))),n=e/Math.max((new Date(Math.max(...r.map(e=>new Date(e.scheduledStart).getTime()))).getTime()-a.getTime())/6048e5,1);if(n<=0)return null;let u=new Date;return u.setDate(u.getDate()+(40-e)/n*7),u}static calculateWeeklyProgress(e){let t=e.filter(e=>"COMPLETED"===e.status&&e.consultantVerifiedAt),s={};return t.forEach(e=>{let t=this.getWeekStart(new Date(e.scheduledStart)).toISOString().split("T")[0];s[t]||(s[t]={hours:0,sessions:0}),s[t].hours+=this.calculateSessionDuration(e),s[t].sessions+=1}),Object.entries(s).map(([e,t])=>({week:e,hours:t.hours,sessions:t.sessions})).sort((e,t)=>e.week.localeCompare(t.week))}static getWeekStart(e){let t=new Date(e),s=t.getDay(),r=t.getDate()-s+(0===s?-6:1);return new Date(t.setDate(r))}static getMilestoneStatus(e){let t=[{name:"Getting Started",hours:0},{name:"First 10 Hours",hours:10},{name:"Quarter Complete",hours:25},{name:"Halfway There",hours:20},{name:"Almost There",hours:30},{name:"Final Stretch",hours:35},{name:"Certification Ready",hours:40}],s=t[0],r=t[1];for(let a=0;a<t.length-1;a++)if(e>=t[a].hours&&e<t[a+1].hours){s=t[a],r=t[a+1];break}let a=r.hours>s.hours?(e-s.hours)/(r.hours-s.hours)*100:100;return{currentMilestone:s.name,nextMilestone:r.name,progressToNext:Math.min(a,100)}}static analyzeConsultantDistribution(e){let t={};return e.forEach(e=>{if("COMPLETED"===e.status&&e.consultantVerifiedAt){let s=e.consultant.id,r=`${e.consultant.user.firstName} ${e.consultant.user.lastName}`;t[s]||(t[s]={consultantId:s,consultantName:r,hours:0,sessions:0}),t[s].hours+=this.calculateSessionDuration(e),t[s].sessions+=1}}),Object.values(t).sort((e,t)=>t.hours-e.hours)}}}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[3267,8814,3449],()=>s(5956));module.exports=r})();