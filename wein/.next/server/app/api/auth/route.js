(()=>{var e={};e.id=5932,e.ids=[5932],e.modules={3524:e=>{"use strict";e.exports=require("@prisma/client")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9348:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},412:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},8893:e=>{"use strict";e.exports=require("buffer")},4770:e=>{"use strict";e.exports=require("crypto")},6162:e=>{"use strict";e.exports=require("stream")},1764:e=>{"use strict";e.exports=require("util")},2041:(e,r,s)=>{"use strict";s.r(r),s.d(r,{patchFetch:()=>R,routeModule:()=>g,serverHooks:()=>y,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>v});var t={};s.r(t),s.d(t,{POST:()=>f});var o=s(2412),n=s(4293),a=s(4147),i=s(7856),u=s(3604),p=s.n(u),d=s(3449),c=s.n(d),l=s(4871);let x=process.env.JWT_SECRET||"your-secret-key";async function f(e){try{let{action:r,email:s,password:t,firstName:o,lastName:n,userType:a,phone:u}=await e.json();if("register"===r)return await m({email:s,password:t,firstName:o,lastName:n,userType:a,phone:u});if("login"===r)return await w({email:s,password:t});return i.NextResponse.json({error:'Invalid action. Use "login" or "register".'},{status:400})}catch(e){return console.error("Auth API Error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function m({email:e,password:r,firstName:s,lastName:t,userType:o,phone:n}){if(!e||!r||!s||!t||!o)return i.NextResponse.json({error:"All required fields must be provided"},{status:400});if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e))return i.NextResponse.json({error:"Invalid email format"},{status:400});if(r.length<8)return i.NextResponse.json({error:"Password must be at least 8 characters long"},{status:400});if(!["STUDENT","CONSULTANT","ADMIN"].includes(o))return i.NextResponse.json({error:"Invalid user type"},{status:400});try{if(await l.db.user.findUnique({where:{email:e}}))return i.NextResponse.json({error:"User with this email already exists"},{status:409});let a=await p().hash(r,12),u=await l.db.user.create({data:{email:e,password:a,firstName:s,lastName:t,userType:o,phone:n||null,status:"ACTIVE"}}),d=c().sign({userId:u.id,email:u.email,userType:u.userType},x,{expiresIn:"7d"}),{password:f,...m}=u;return i.NextResponse.json({message:"User registered successfully",user:m,token:d})}catch(e){return console.error("Registration error:",e),i.NextResponse.json({error:"Failed to create user"},{status:500})}}async function w({email:e,password:r}){if(!e||!r)return i.NextResponse.json({error:"Email and password are required"},{status:400});try{let s=await l.db.user.findUnique({where:{email:e}});if(!s)return i.NextResponse.json({error:"Invalid email or password"},{status:401});if("ACTIVE"!==s.status)return i.NextResponse.json({error:"Account is not active"},{status:401});if(!await p().compare(r,s.password))return i.NextResponse.json({error:"Invalid email or password"},{status:401});let t=c().sign({userId:s.id,email:s.email,userType:s.userType},x,{expiresIn:"7d"}),{password:o,...n}=s;return i.NextResponse.json({message:"Login successful",user:n,token:t})}catch(e){return console.error("Login error:",e),i.NextResponse.json({error:"Login failed"},{status:500})}}let g=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/auth/route",pathname:"/api/auth",filename:"route",bundlePath:"app/api/auth/route"},resolvedPagePath:"/Users/dgb_1011/Desktop/WeIn/WeIn/wein/src/app/api/auth/route.ts",nextConfigOutput:"",userland:t}),{workAsyncStorage:h,workUnitAsyncStorage:v,serverHooks:y}=g;function R(){return(0,a.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:v})}},5303:()=>{},4871:(e,r,s)=>{"use strict";s.d(r,{db:()=>o});var t=s(3524);let o=globalThis.prisma??new t.PrismaClient({log:["error"],datasources:{db:{url:process.env.DATABASE_URL}}});process.on("beforeExit",async()=>{await o.$disconnect()})}};var r=require("../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[3267,8814,3449,3604],()=>s(2041));module.exports=t})();